{
  "$schema": "https://railway.app/railway.schema.json",
  "name": "OpenMonetize",
  "description": "Open-source AI usage metering and billing platform. Track tokens, manage credits, and bill for LLM usage (OpenAI, Anthropic, Gemini).",
  "repositoryUrl": "https://github.com/openmonetize/openmonetize",
  "imageUrl": "https://openmonetize.com/logo.png",
  "codeUrl": "https://github.com/openmonetize/openmonetize",
  "demoUrl": "https://demo.openmonetize.com",
  "services": {
    "postgres": {
      "image": "postgres:16-alpine",
      "variables": {
        "POSTGRES_USER": {
          "description": "The PostgreSQL user",
          "defaultValue": "postgres"
        },
        "POSTGRES_PASSWORD": {
          "description": "The PostgreSQL password",
          "defaultValue": "${{POSTGRES_PASSWORD}}"
        },
        "POSTGRES_DB": {
          "description": "The PostgreSQL database name",
          "defaultValue": "railway"
        },
        "DATABASE_URL": {
          "description": "The connection string for the PostgreSQL database",
          "defaultValue": "postgresql://${{POSTGRES_USER}}:${{POSTGRES_PASSWORD}}@${{RAILWAY_PRIVATE_DOMAIN}}:5432/${{POSTGRES_DB}}"
        },
        "PGDATA": {
          "description": "The directory where PostgreSQL stores data",
          "defaultValue": "/var/lib/postgresql/data"
        },
        "PGPORT": {
          "description": "The port PostgreSQL listens on",
          "defaultValue": "5432"
        }
      }
    },
    "redis": {
      "image": "redis:7-alpine",
      "variables": {
        "REDIS_PASSWORD": {
          "description": "The Redis password",
          "defaultValue": "${{REDIS_PASSWORD}}"
        },
        "REDIS_URL": {
          "description": "The connection string for Redis",
          "defaultValue": "redis://:${{REDIS_PASSWORD}}@${{RAILWAY_PRIVATE_DOMAIN}}:6379"
        },
        "REDISPORT": {
          "description": "The port Redis listens on",
          "defaultValue": "6379"
        },
        "REDISUSER": {
          "description": "The Redis user",
          "defaultValue": "default"
        }
      }
    },
    "api-gateway": {
      "build": {
        "builder": "NIXPACKS",
        "root": "platform",
        "buildCommand": "pnpm install && pnpm db:deploy && pnpm build --filter=api-gateway...",
        "watchPatterns": [
          "packages/api-gateway/**",
          "packages/common/**"
        ]
      },
      "deploy": {
        "startCommand": "npm run start:api",
        "initCommand": "pnpm db:seed"
      },
      "variables": {
        "NIXPACKS_PROVIDERS": "node",
        "NODE_ENV": "production",
        "PORT": {
          "description": "The port the API Gateway listens on",
          "defaultValue": "3000"
        },
        "HOST": {
          "description": "The host the API Gateway binds to",
          "defaultValue": "0.0.0.0"
        },
        "DATABASE_URL": {
          "description": "The connection string for the PostgreSQL database",
          "defaultValue": "${{postgres.DATABASE_URL}}"
        },
        "REDIS_URL": {
          "description": "The connection string for Redis",
          "defaultValue": "${{redis.REDIS_URL}}"
        },
        "INGESTION_SERVICE_URL": {
          "description": "The internal URL of the Ingestion Service",
          "defaultValue": "http://${{ingestion-service.HOST}}:${{ingestion-service.PORT}}"
        },
        "RATING_SERVICE_URL": {
          "description": "The internal URL of the Rating Engine",
          "defaultValue": "http://${{rating-engine.HOST}}:${{rating-engine.PORT}}"
        },
        "RATE_LIMIT_MAX": {
          "description": "Maximum number of requests per window",
          "defaultValue": "60"
        },
        "RATE_LIMIT_WINDOW": {
          "description": "Time window for rate limiting (e.g. '1 minute')",
          "defaultValue": "1 minute"
        },
        "LOG_LEVEL": {
          "description": "Logging level (debug, info, warn, error)",
          "defaultValue": "info"
        },
        "RAILWAY_DEPLOYMENT_DRAINING_SECONDS": {
          "description": "Time to wait for connections to drain during deployment",
          "defaultValue": "30"
        }
      }
    },
    "ingestion-service": {
      "build": {
        "builder": "NIXPACKS",
        "root": "platform",
        "buildCommand": "pnpm install && pnpm build --filter=ingestion-service...",
        "watchPatterns": [
          "packages/ingestion-service/**",
          "packages/common/**"
        ]
      },
      "deploy": {
        "startCommand": "npm run start:ingestion"
      },
      "variables": {
        "NIXPACKS_PROVIDERS": "node",
        "NODE_ENV": "production",
        "PORT": {
          "description": "The port the Ingestion Service listens on",
          "defaultValue": "8081"
        },
        "HOST": {
          "description": "The host the Ingestion Service binds to",
          "defaultValue": "0.0.0.0"
        },
        "DATABASE_URL": {
          "description": "The connection string for the PostgreSQL database",
          "defaultValue": "${{postgres.DATABASE_URL}}"
        },
        "REDIS_URL": {
          "description": "The connection string for Redis",
          "defaultValue": "${{redis.REDIS_URL}}"
        },
        "RATE_LIMIT_MAX": {
          "description": "Maximum number of requests per window",
          "defaultValue": "1000"
        },
        "RATE_LIMIT_WINDOW": {
          "description": "Time window for rate limiting (e.g. '1 minute')",
          "defaultValue": "1 minute"
        },
        "QUEUE_NAME": {
          "description": "Name of the Redis queue for usage events",
          "defaultValue": "usage-events"
        },
        "QUEUE_CONCURRENCY": {
          "description": "Number of concurrent queue consumers",
          "defaultValue": "10"
        }
      }
    },
    "rating-engine": {
      "build": {
        "builder": "NIXPACKS",
        "root": "platform",
        "buildCommand": "pnpm install && pnpm build --filter=rating-engine...",
        "watchPatterns": [
          "packages/rating-engine/**",
          "packages/common/**"
        ]
      },
      "deploy": {
        "startCommand": "npm run start:rating"
      },
      "variables": {
        "NIXPACKS_PROVIDERS": "node",
        "NODE_ENV": "production",
        "PORT": {
          "description": "The port the Rating Engine listens on",
          "defaultValue": "3002"
        },
        "HOST": {
          "description": "The host the Rating Engine binds to",
          "defaultValue": "0.0.0.0"
        },
        "DATABASE_URL": {
          "description": "The connection string for the PostgreSQL database",
          "defaultValue": "${{postgres.DATABASE_URL}}"
        }
      }
    },
    "dashboard": {
      "build": {
        "builder": "NIXPACKS",
        "root": "platform",
        "buildCommand": "pnpm install && pnpm build --filter=dashboard...",
        "watchPatterns": [
          "apps/dashboard/**",
          "packages/sdk/**"
        ]
      },
      "deploy": {
        "startCommand": "pnpm start --filter=dashboard"
      },
      "variables": {
        "NIXPACKS_PROVIDERS": "node",
        "NODE_ENV": "production",
        "PORT": {
          "description": "The port the Dashboard listens on",
          "defaultValue": "3000"
        },
        "HOST": {
          "description": "The host the Dashboard binds to",
          "defaultValue": "0.0.0.0"
        },
        "NEXT_PUBLIC_API_URL": {
          "description": "The public URL of the API Gateway",
          "defaultValue": "https://${{api-gateway.RAILWAY_PUBLIC_DOMAIN}}"
        },
        "NEXTAUTH_SECRET": {
          "description": "Secret used to encrypt session data",
          "defaultValue": "${{NEXTAUTH_SECRET}}"
        },
        "GOOGLE_CLIENT_ID": {
          "description": "Google OAuth Client ID",
          "defaultValue": ""
        },
        "GOOGLE_CLIENT_SECRET": {
          "description": "Google OAuth Client Secret",
          "defaultValue": ""
        },
        "DEMO_MODE": {
          "description": "Enable demo mode features",
          "defaultValue": "false"
        },
        "DEMO_API_KEY": {
          "description": "API Key for demo purposes",
          "defaultValue": ""
        },
        "DEMO_TENANT_ID": {
          "description": "Tenant ID for demo purposes",
          "defaultValue": ""
        },
        "PUBLIC_DOCS_URL": {
          "description": "URL to public documentation",
          "defaultValue": "https://docs.openmonetize.com"
        }
      }
    }
  }
}