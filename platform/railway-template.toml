[template]
name = "OpenMonetize"
description = "Open-source AI usage metering and billing platform. Track tokens, manage credits, and bill for LLM usage (OpenAI, Anthropic, Gemini)."
repositoryUrl = "https://github.com/openmonetize/openmonetize"
imageUrl = "https://openmonetize.com/logo.png" # Placeholder, user should update
codeUrl = "https://github.com/openmonetize/openmonetize"
demoUrl = "https://demo.openmonetize.com"

[build]
builder = "dockerfile"

# Define services
[[services]]
name = "postgres"
type = "database"
database = "postgresql"

[[services]]
name = "redis"
type = "database"
database = "redis"

[[services]]
name = "api-gateway"
dockerfile = "packages/api-gateway/Dockerfile"

[services.variables]
NODE_ENV = "production"
PORT = "3000"
HOST = "0.0.0.0"
DATABASE_URL = "${{Postgres.DATABASE_URL}}"
REDIS_URL = "${{Redis.REDIS_URL}}"

[services.healthcheck]
path = "/health"
port = 3000

[[services]]
name = "ingestion-service"
dockerfile = "packages/ingestion-service/Dockerfile"

[services.variables]
NODE_ENV = "production"
PORT = "8081"
HOST = "0.0.0.0"
DATABASE_URL = "${{Postgres.DATABASE_URL}}"
REDIS_URL = "${{Redis.REDIS_URL}}"
RATE_LIMIT_MAX = "1000"
RATE_LIMIT_WINDOW_MS = "60000"
QUEUE_NAME = "usage-events"
QUEUE_CONCURRENCY = "10"

[services.healthcheck]
path = "/health"
port = 8081

[[services]]
name = "rating-engine"
dockerfile = "packages/rating-engine/Dockerfile"

[services.variables]
NODE_ENV = "production"
PORT = "3002"
HOST = "0.0.0.0"
DATABASE_URL = "${{Postgres.DATABASE_URL}}"

[services.healthcheck]
path = "/health"
port = 3002

